#include <stdio.h>
#include <string.h>
#include <fcntl.h>
#include <sys/stat.h>
#include "hacking.h"

#define FILENAME "/var/notes"

int print_notes(int, int, char *);  // Note printing function.
int find_user_note(int , int);      // Seek in file for a note for user.
int search_note(char*, char*);      // Search for keyword function.
void fatal(char *);                 // Fatal error handler

int main(int argc, char *argv[]) {
  int userid, printing = 1, fd;  // File descriptor
  char searchstring[100];

  if(argc > 1)                   // If there is an arg,
    strcpy(searchstring, argv[1]);  // that is the search string;
  else                            // otherwise,
    searchstring[0] = 0;         // search string is empty.

  userid = getuid();
  fd = open(FILENAME,O_RDONLY); // Open the file for read-only access.
  if(fd == -1)
    fatal("in main() while opening file for reading");
  
  while(printing)
    printing = print_notes(fd, userid, searchstring);
  printf("-----------[ end of note data ] ----------------\n");
  close(fd);
}
